<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://s3.pstatp.com/cdn/expire-1-M/jquery/3.2.1/jquery.min.js"></script>
    <title>今日纪年信息</title>
    <style type="text/css">
        /* 右下角显示 */
        .rigdown {
            position: fixed;
            bottom: 3px;
            right: 0;
            padding: 8px;
        }
    </style>
</head>

<body>
    <!-- 阳历今日信息 -->
    <div style="text-align: center;">
        <button type="button" id="todayid" onclick="today()">点击显示今日信息</button>
        <a href="/"> <button onchange="home()"><b>点击返回主界面</b></button></a>
        <a href="/jz60"><button onchange="jz60page()"><b>点击跳转到干支查询页面</b></button></a>
    </div>

    <hr>
    <div style="text-align: center;">
        <p id="page"></p>
        <p id="selectP"></p>
    </div>
    <hr>
    <!-- 关于 -->
    <p id="show"></p>

    <script>
        //阳历今日信息
        function today() {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/today",
                data: $('#todayid').serialize(),
                success: function (data) {
                   // console.log(typeof data.lu)
                    var p = document.getElementById("page");
                    p.innerHTML = data.todayInfo;
                },
                error: function () {
                    alert("今日信息异常");
                }
            });
        }
        //跳转回主页
        function home() {
            window.open("/");
        }
        //干支查询页面
        function jz60page(){
            window.open("/jz60");
        }
    </script>

    <!-- 关于 -->
    <script>
               var xhr = new XMLHttpRequest();
               xhr.open("POST", "/today", true);//请求方式 请求地址
               xhr.send();
               xhr.onreadystatechange = function () {
                   if (xhr.readyState == 4 && xhr.status == 200) {
                       var fromserve = xhr.responseText;//从服务器传过来的 数据
                       var ps = JSON.parse(fromserve);//解析json数据
                       var ccal = ps.Ccal;
                       var data = ps.Data;
                       var xlr = ps.Xlr;
                       var xjbf = ps.Xjbf;
                       var ck = ps.Ck;
                       var me = ps.Me;
                       //写数据呈现到指定页面位置
                       var px = document.getElementById("show");
                       px.innerHTML = ccal + "<br />" + data + "<br />" + xlr + "<br />" + xjbf + "<br />" + ck + "<br />" + me;
                   };
               }; 
    </script>

    <!-- 网页计数 https://www.jb51.net/article/31349.htm-->
    <div class="rigdown">
        <p id="rig"></p>
    </div>
    <script language="JavaScript">
        var caution = false
        function setCookie(name, value, expires, path, domain, secure) {
            var curCookie = name + "=" + escape(value) +
                ((expires) ? "; expires=" + expires.toGMTString() : "") +
                ((path) ? "; path=" + path : "") +
                ((domain) ? "; domain=" + domain : "") +
                ((secure) ? "; secure" : "")
            if (!caution || (name + "=" + escape(value)).length <= 4000)
                document.cookie = curCookie
            else
                if (confirm("Cookie exceeds 4KB and will be cut!"))
                    document.cookie = curCookie
        }
        function getCookie(name) {
            var prefix = name + "="
            var cookieStartIndex = document.cookie.indexOf(prefix)
            if (cookieStartIndex == -1)
                return null
            var cookieEndIndex = document.cookie.indexOf(";", cookieStartIndex + prefix.length)
            if (cookieEndIndex == -1)
                cookieEndIndex = document.cookie.length
            return unescape(document.cookie.substring(cookieStartIndex + prefix.length, cookieEndIndex))
        }
        function deleteCookie(name, path, domain) {
            if (getCookie(name)) {
                document.cookie = name + "=" +
                    ((path) ? "; path=" + path : "") +
                    ((domain) ? "; domain=" + domain : "") +
                    "; expires=Thu, 01-Jan-70 00:00:01 GMT"
            }
        }
        function fixDate(date) {
            var base = new Date(0)
            var skew = base.getTime()
            if (skew > 0)
                date.setTime(date.getTime() - skew)
        }
        var now = new Date()
        fixDate(now)
        now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000)
        var visits = getCookie("counter")
        if (!visits)
            visits = 1
        else
            visits = parseInt(visits) + 1
        setCookie("counter", visits, now)
        //var n = document.write("您是到访的第" + visits + "位用户！");
        var p = document.getElementById("rig");
        p.innerHTML = "您是到访的第" + visits + "位用户！";
    </script>
</body>

</html>
